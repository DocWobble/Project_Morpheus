# DECISIONS.log

> ADR-style, but ruthless. One entry per consequential choice.  
> Append-only; if superseded, add `Superseded-By:` and status `REPLACED`.

## Entry Template

### [YYYY-MM-DD] <short handle>

- **Context:** <why a choice was necessary; constraints at play>
- **Decision:** <the chosen path in one or two sentences>
- **Alternatives:** <bulleted, only those genuinely considered>
- **Trade-offs:** <what we accept to get the outcome>
- **Scope:** <surfaces or modules affected>
- **Impact:** <capabilities enabled/disabled; risks introduced>
- **TTL / Review:** <when to re-evaluate, if applicable>
- **Status:** ACTIVE | REPLACED | REJECTED | BLOCKED
- **Links:** <PRs, scenes, interface entries, goal names>

_(New entries go on top. Keep each under ~20 lines.)_


### [2025-08-24] one-click-docs

- **Context:** Users were unclear about what `scripts/one_click.py` automates and which setup steps remain manual.
- **Decision:** Document that the script downloads Miniforge, creates `.venv`, installs `requirements.txt`, and note that GPU-specific wheels and environment activation are still manual.
- **Alternatives:** Leave the brief description and assume prior knowledge.
- **Trade-offs:** Slightly longer README section for clearer setup expectations.
- **Scope:** `README.md`, `DECISIONS.log`.
- **Impact:** Clarifies setup flow and reduces onboarding friction.
- **TTL / Review:** Revisit if `one_click.py` gains hardware-specific installation or auto-activation.
- **Status:** ACTIVE
- **Links:** n/a

### [2025-08-24] one-click-venv

- **Context:** Dependency installation previously used the system Python and assumed a pre-existing virtual environment.
- **Decision:** Ensure `.venv` is created if missing and use its Python when installing requirements.
- **Alternatives:** Require manual environment creation; continue using `sys.executable` directly.
- **Trade-offs:** Adds setup steps but yields isolated and reproducible environments.
- **Scope:** `scripts/one_click.py`, `tests/test_one_click.py`.
- **Impact:** One-click setup now bootstraps a dedicated virtualenv for dependency installation.
- **TTL / Review:** Reassess if distribution shifts to packaged installers.
- **Status:** ACTIVE
- **Links:** auto-venv-setup


### [2025-08-24] orpheus-local-none-stop

- **Context:** `_stream_from_model` assumed the underlying iterator raised `StopIteration`; some `orpheus_cpp` iterators instead returned `None`, causing `TypeError` during unpacking.
- **Decision:** Invoke `next` with a `None` sentinel inside a thread and break when `None` is returned, avoiding unpacking errors.
- **Alternatives:** Keep try/except expecting `StopIteration`.
- **Trade-offs:** Adapts to nonconformant iterators at the cost of deviating from the generator protocol.
- **Scope:** `Morpheus_Client/tts_engine/orpheus_local.py`, tests.
- **Impact:** Local TTS streaming terminates cleanly when the model signals completion by returning `None`.
- **TTL / Review:** Revisit if upstream iterator behavior changes.
- **Status:** ACTIVE
- **Links:** test_stream_from_model_none_termination

### [2025-11-24] admin-index-default

- **Context:** The admin dashboard HTML lived at `tts.html`, so navigating to `/admin/` yielded a 404 unless the file name was specified.
- **Decision:** Rename `tts.html` to `index.html` so the admin UI serves by default at `/admin/`.
- **Alternatives:** Keep the file name and add a redirect; mount the static folder at `/`.
- **Trade-offs:** Direct links to `tts.html` break but the route becomes intuitive.
- **Scope:** `Morpheus_Client/admin/index.html`, tests, `/admin` surface.
- **Impact:** Operators can visit `/admin/` without knowing the HTML file name.
- **TTL / Review:** Revisit if the admin UI gains routing.
- **Status:** ACTIVE
- **Links:** interface admin-endpoint, goal admin-voices-runtime

### [2025-08-24] miniforge-idempotent

- **Context:** `scripts/one_click.py` attempted a fresh Miniforge install even when the target directory already existed.
- **Decision:** Detect existing `miniforge3` directories and skip installer execution to make setup idempotent.
- **Alternatives:** Always run the installer with an update flag; rely solely on `conda` being on `PATH`.
- **Trade-offs:** Skipping avoids unintended reinstalls but forgoes automatic updates.
- **Scope:** `scripts/one_click.py`.
- **Impact:** Re-running the setup script exits cleanly when Miniforge is present.
- **TTL / Review:** Revisit if Miniforge offers a cross-platform update mode.
- **Status:** ACTIVE
- **Links:** goal idempotent-miniforge-setup

### [2025-11-07] orpheus-cpp-docs

- **Context:** Installation instructions duplicated manual `orpheus-cpp` steps despite the dependency being pinned in `requirements.txt`.
- **Decision:** Keep `orpheus-cpp` in `requirements.txt` and document C++ build prerequisites prior to running `pip install -r requirements.txt`.
- **Alternatives:** Drop the package from the requirements and require a standalone install.
- **Trade-offs:** Users must prepare a C++ toolchain before installing dependencies.
- **Scope:** `README.md`, `DECISIONS.log`.
- **Impact:** Clearer install flow and avoids redundant package commands.
- **TTL / Review:** Revisit if prebuilt wheels land or another default adapter is chosen.
- **Status:** ACTIVE
- **Links:** goal orpheus-cpp-startup-check

### [2025-11-06] trim-requirements

- **Context:** `requirements.txt` carried numerous training and UI dependencies unused by the Morpheus client/server.
- **Decision:** Remove obsolete packages and stub `sounddevice` so the server imports cleanly without native libraries.
- **Alternatives:** Leave the full list intact or require system-wide PortAudio.
- **Trade-offs:** Ancillary scripts may require manual installs when executed.
- **Scope:** `requirements.txt`, `Morpheus_Client/tts_engine/inference.py`, `Morpheus_Client/tts_engine/__init__.py`, `CHANGES.md`.
- **Impact:** Smaller install surface and predictable startup.
- **TTL / Review:** Revisit when new capabilities demand additional dependencies.
- **Status:** ACTIVE
- **Links:** N/A

### [2025-08-24] consolidate-readmes

- **Context:** Duplicate README and requirements files scattered documentation and setup guidance.
- **Decision:** Retain only root `README.md` and `requirements.txt`; archive other variants and clarify text streaming and UI startup in docs.
- **Alternatives:** Maintain per-module documentation and requirement lists.
- **Trade-offs:** Local instructions removed in favor of a single reference.
- **Scope:** `README.md`, `SCENES/README.md`, `TASKS/README.md`, `Morpheus_Client/README.md`.
- **Impact:** Centralized onboarding with accurate text-stream output description.
- **TTL / Review:** Revisit if modules require dedicated docs again.
- **Status:** active
- **Links:** goal centralized-docs
### [2025-10-24] orpheus-cpp-default

- **Context:** Remote `ORPHEUS_API_URL` checks lingered despite local `orpheus_cpp` engine being the primary path.
- **Decision:** Drop API URL requirements, isolate remote helpers, and register `orpheus_cpp` as the default adapter.
- **Alternatives:** Keep mixed local/remote logic in `inference.py`.
- **Trade-offs:** Remote API helpers move to a separate module requiring explicit import.
- **Scope:** `Morpheus_Client/tts_engine`, `Morpheus_Client/server.py`, `README.md`.
- **Impact:** Simplifies configuration and clarifies in-process synthesis.
- **TTL / Review:** Revisit if remote backends become first-class.
- **Status:** ACTIVE
- **Links:** N/A
### [2025-10-15] admin-config-cleanup

- **Context:** Admin UI retained FastAPI branding and referenced a non-existent restart endpoint; config selectors omitted voice, adapter, and source.
- **Decision:** Drop FastAPI branding and restart controls, and wire voice, adapter, and text-source selectors through `/config`.
- **Alternatives:** Keep legacy branding and dead controls.
- **Trade-offs:** Slightly more client-side code; removes explicit restart flow.
- **Scope:** `Morpheus_Client/admin/tts.html`.
- **Impact:** UI aligns with current config API; removes broken endpoints.
- **TTL / Review:** revisit when admin features grow.
- **Status:** ACTIVE
- **Links:** interfaces config-endpoint
### [2025-09-30] orpheus-cpp-required

- **Context:** Starting the service without `orpheus_cpp` led to runtime failures during synthesis.
- **Decision:** Pin `orpheus-cpp` and abort startup with a descriptive error when the module is missing.
- **Alternatives:** Import on first use and fail lazily; rely on an external service for synthesis.
- **Trade-offs:** Adds a native build step that increases installation time.
- **Scope:** `requirements.txt`, `scripts/start.py`, `README.md`.
- **Impact:** Predictable startup behaviour and clearer dependency expectations.
- **TTL / Review:** Revisit if a pure-Python or remote backend becomes default.
- **Status:** ACTIVE
- **Links:** goal orpheus-cpp-startup-check, tests/test_start_requires_orpheus_cpp.py
### [2025-09-21] fastapi-migration

- **Context:** Docs and configs still referenced FastAPI though the service now runs on a lightweight ASGI stack.
- **Decision:** Purge FastAPI references and document the single ASGI service exposing `/v1/audio/speech`, `/config`, `/stats`, and `/admin`.
- **Alternatives:** Keep FastAPI terminology and partial code paths.
- **Trade-offs:** Lose FastAPI conveniences like automatic docs and dependency injection.
- **Scope:** `AGENTS.md`, `GOALS.md`, `README.md`, `INTERFACES.md`.
- **Impact:** Aligns repository language with actual architecture; reduces confusion.
- **TTL / Review:** Revisit if a higher-level framework is reintroduced.
- **Status:** ACTIVE
- **Links:** goals standalone-orchestrator, admin-interface; interfaces speech-endpoint, config-endpoint, stats-endpoint, admin-endpoint

### [2025-09-19] start-entrypoint

- **Context:** Simplify local launch and persist config in home directory.
- **Decision:** Use scripts/start.py as single entrypoint that loads ~/.morpheus/config and opens the admin UI; remove main.py and old start scripts.
- **Alternatives:** Keep main.py and one-click shell scripts.
- **Trade-offs:** Removes automatic dependency installation.
- **Scope:** scripts/start.py, start scripts, README.md.
- **Impact:** Unified startup, persistent config, and browser auto-launch.
- **TTL / Review:** Revisit if startup workflow changes.
- **Status:** ACTIVE
- **Links:** goal auto-start-config

### [2025-09-18] retire-orfastapi

- **Context:** A legacy FastAPI module duplicated the unified Morpheus Client server.
- **Decision:** Remove the legacy module, migrate remaining assets, and update start scripts and docs.
- **Alternatives:** Keep the old module alongside the new server.
- **Trade-offs:** Loss of historical code; any missing functionality must be re-added to the client.
- **Scope:** start scripts, tests, documentation, `Morpheus_Client/admin` assets.
- **Impact:** Single launch path via `main.py`; no lingering imports of the removed module.
- **TTL / Review:** Revisit if a separate API service is required again.
- **Status:** active
- **Links:** n/a
### [2025-09-06] consolidate-requirements

- **Context:** Multiple hardware-specific requirement files complicated installation.
- **Decision:** Collapse them into a single pinned requirements.txt with hardware notes and update setup scripts.
- **Alternatives:** Keep separate requirement sets per platform.
- **Trade-offs:** Users must manually install GPU extras.
- **Scope:** requirements.txt, scripts/install.py, scripts/one_click.py, README.md.
- **Impact:** Simplifies dependency management and documentation.
- **TTL / Review:** Revisit if automated GPU package resolution is needed.
- **Status:** ACTIVE
- **Links:** goal unified-dependency-management
### [2025-09-01] single-service-architecture

- **Context:** Prior repos split orchestration and admin surfaces; deployment required coordinating multiple services.
- **Decision:** Consolidate into one service exposing `/stats`, `/config`, and `/admin` with `.env`-based configuration.
- **Alternatives:** Maintain separate processes for TTS generation, control plane, and UI; shell scripts per component.
- **Trade-offs:** Sacrifices modular scaling but simplifies local runs and scene coverage.
- **Scope:** `Morpheus_Client/server.py`, runtime config paths, admin endpoints.
- **Impact:** Enables standalone orchestrator, admin interface, and direct inference integration.
- **TTL / Review:** Revisit when horizontal scaling or process isolation is required.
- **Status:** ACTIVE
- **Links:** goals standalone-orchestrator, admin-interface, direct-inference-integration; interfaces /stats, /config, /admin
### [2025-08-18] decisions-log-canonical

- **Context:** Repository contained `DECISIONS.md` while documentation referenced `DECISIONS.log`, causing inconsistency.
- **Decision:** Rename the decision log to `DECISIONS.log` and update references for a single canonical filename.
- **Alternatives:** Keep `DECISIONS.md` and adjust all docs.
- **Trade-offs:** `.log` extension receives less automatic Markdown tooling.
- **Scope:** repository metadata files.
- **Impact:** Eliminates confusion about where to record decisions.
- **TTL / Review:** Revisit if extension hampers collaboration.
- **Status:** ACTIVE
- **Links:** this PR

### [2025-08-30] cli-exitcode-refactor

- **Context:** Subcommands invoked std::process::exit directly, complicating error handling and testing.
- **Decision:** Return ExitCode from `cli_main` and exit once in `main`.
- **Alternatives:** Keep multiple exit points within subcommands.
- **Trade-offs:** Requires threading exit codes through call sites.
- **Scope:** `codex-rs/cli`, `codex-rs/arg0`.
- **Impact:** Centralizes process termination and enables integration tests to assert exact exit codes.
- **TTL / Review:** Revisit if CLI architecture changes.
- **Status:** ACTIVE
- **Links:** goal cli-exit-code-centralization


### [2025-08-29] cli-path-dedup

- **Context:** Repeated CLI launches added duplicate directories to `PATH` causing unbounded growth.
- **Decision:** Skip directories already present in `PATH` when computing the updated value.
- **Alternatives:** Keep existing behavior and allow duplicates.
- **Trade-offs:** Slight increase in startup logic complexity.
- **Scope:** `codex-cli/bin/codex.js`.
- **Impact:** CLI startup is idempotent with respect to environment `PATH`.
- **TTL / Review:** Revisit if environment handling changes.
- **Status:** ACTIVE
- **Links:** goal cli-path-deduplication; `codex-cli/test/path.test.js`

### [2025-08-17] missing-sandbox-error

- **Context:** `codex-cli` panicked when the `codex-linux-sandbox` binary was missing.
- **Decision:** Return a descriptive error instead of panicking so users understand the failure.
- **Alternatives:** Keep using `.expect` and crash.
- **Trade-offs:** Slightly more code; reliance on error handling.
- **Scope:** `codex-rs/cli` sandbox command path.
- **Impact:** CLI fails gracefully when Landlock sandbox is requested without the binary.
- **TTL / Review:** Revisit if sandbox architecture changes.
- **Status:** ACTIVE
- **Links:** See PR for missing sandbox executable handling.

### [2025-08-19] login-result-handling

- **Context:** Login helpers exited the process directly, making reuse and testing difficult.
- **Decision:** Return `Result`/status enums from login helpers and manage exits in `main.rs`.
- **Alternatives:** Keep process termination inside helper functions.
- **Trade-offs:** More boilerplate in the caller; functions now expose additional types.
- **Scope:** `codex-rs/cli` login module and main entrypoint.
- **Impact:** Enables programmatic control over login flows and clearer testing.
- **TTL / Review:** Revisit when authentication flow changes.
- **Status:** ACTIVE
- **Links:** goal result-based-login
### [2025-09-02] central-config-module

- **Context:** configuration helpers were duplicated across `main.py` and the server module.
- **Decision:** centralize env file utilities and config API routes in `Morpheus_Client.config`.
- **Alternatives:** keep separate implementations in each module.
- **Trade-offs:** introduces a new package; minor import overhead.
- **Scope:** `Morpheus_Client/config.py`, `main.py`, `Morpheus_Client/server.py`.
- **Impact:** shared configuration logic and API surface; easier future reuse.
- **TTL / Review:** revisit when configuration loading changes.
- **Status:** active
- **Links:** n/a
### [2025-08-18] morpheus-client-endpoints
- **Context:** Morpheus Client lacked introspection APIs for voices and adapters.
- **Decision:** Add `/v1/audio/voices` and `/adapters` endpoints reusing logic from the legacy service.
- **Alternatives:** Rely solely on that separate service for capability discovery.
- **Trade-offs:** Duplicates minimal logic; adds another API surface to maintain.
- **Scope:** `Morpheus_Client/server.py`, `INTERFACES.md`.
- **Impact:** Clients can query available voices and adapter capabilities directly.
- **TTL / Review:** revisit when services consolidate.
- **Status:** active
- **Links:** goal morpheus-client-introspection
### [2025-09-02] admin-static-mount

- **Context:** The admin TTS UI lived only in a separate service and wasn't available through the consolidated client.
- **Decision:** Copy the template and favicon into `Morpheus_Client/admin` and serve them via `/admin`.
- **Alternatives:** Continue relying on that external service for admin access.
- **Trade-offs:** Duplicates assets and requires future sync.
- **Scope:** `Morpheus_Client/admin`, `Morpheus_Client/server.py`, `Morpheus_Client/config.py`.
- **Impact:** Admin interface assets are accessible from the client service.
- **TTL / Review:** revisit when UI unification completes.
- **Status:** active
- **Links:** goal admin-interface
### [2025-09-02] admin-favicon-svg

- **Context:** Binary favicon blocked pull request generation.
- **Decision:** Replace `.ico` with a text-based `favicon.svg` and update the admin template.
- **Alternatives:** Keep binary icon and accept PR tooling limitation.
- **Trade-offs:** Simplified icon; avoids binary files in repository.
- **Scope:** `Morpheus_Client/admin/tts.html`, `Morpheus_Client/admin/static/favicon.svg`.
- **Impact:** Admin interface assets remain mergeable while providing a visual icon.
- **TTL / Review:** revisit when branding assets stabilize.
- **Status:** active
- **Links:** goal admin-interface

### [2025-09-05] morpheus-client-rename

- **Context:** The codebase exposed `morpheus_tts` for core TTS functions while the admin/API lived under `Morpheus_Client`, leading to split imports.
- **Decision:** Rename `morpheus_tts` to `Morpheus_Client` and merge the admin and TTS server under one package with a single `start_server` entrypoint.
- **Alternatives:** Keep dual packages and bridge imports manually.
- **Trade-offs:** External references must update to the new package name.
- **Scope:** `Morpheus_Client/server.py`, `main.py`, `scenes/*`, `tests/*`.
- **Impact:** Unified import path `Morpheus_Client.*` and consolidated API/admin launch.
- **TTL / Review:** review after first release.
- **Status:** active
- **Links:** goal morpheus-client-introspection

### [2025-09-08] orchestrator-timeline

- **Context:** Need visibility into orchestrator stages and live stats.
- **Decision:** Emit `{stage,duration_ms,result}` events, persist to `SCENES/_artifacts/timeline.json`, and expose `/stats` API.
- **Alternatives:** Rely solely on logging without structured timeline.
- **Trade-offs:** In-memory event list may grow without bounds.
- **Scope:** `Morpheus_Client/orchestrator/core.py`, `scenes/utils.py`, `Morpheus_Client/server.py`.
- **Impact:** Enables live monitoring and replayable transcripts.
- **TTL / Review:** review after initial deployment.
- **Status:** active
- **Links:** goal streaming-telemetry

### [2025-09-14] text-source-adapters

- **Context:** Need to ingest text from multiple origins for synthesis.
- **Decision:** Introduce `TextSource` protocol with adapters for WebSocket, HTTP polling and CLI pipes.
- **Alternatives:** Hardcode a single input mechanism.
- **Trade-offs:** Additional registry and configuration surface.
- **Scope:** `text_sources/*`, `Morpheus_Client/server.py`, `ADAPTERS.md`, `INTERFACES.md`.
- **Impact:** Text sources are pluggable and selectable via `/config`.
- **TTL / Review:** revisit when more sources are required.
- **Status:** active
- **Links:** goal pluggable-text-sources

### [2025-08-19] starlette-router

- **Context:** Reduce dependency weight for HTTP and WebSocket handling.
- **Decision:** Replace FastAPI server with a Starlette-based ASGI app.
- **Alternatives:** Keep FastAPI.
- **Trade-offs:** Manual request parsing; fewer built-in features.
- **Scope:** `Morpheus_Client/server.py`, `Morpheus_Client/client.py`.
- **Impact:** Lighter runtime while preserving public API.
- **TTL / Review:** revisit when advanced routing/features are required.
- **Status:** active
- **Links:** –

### [2025-09-26] fastapi-cleanup

- **Context:** Starlette migration left behind FastAPI-specific imports and dependencies.
- **Decision:** Purge FastAPI from tests and requirements; simplify config utilities to avoid FastAPI.
- **Alternatives:** Retain FastAPI modules alongside Starlette.
- **Trade-offs:** Fewer helper utilities from FastAPI.
- **Scope:** `requirements.txt`, `tests/test_stats_endpoint.py`, `Morpheus_Client/config.py`.
- **Impact:** Leaner dependency graph and tests target the Starlette ASGI app.
- **TTL / Review:** revisit if configuration endpoints need richer framework support.
- **Status:** active
- **Links:** –

### [2025-10-09] config-persistence

- **Context:** Configuration changes via the API were volatile and lost on restart.
- **Decision:** Expose `GET /config` and persist `POST /config` updates through `Morpheus_Client.config.save_config`.
- **Alternatives:** Keep in-memory configuration only.
- **Trade-offs:** `.env` rewrites may race under concurrent updates.
- **Scope:** `Morpheus_Client/server.py`, `INTERFACES.md`, `tests/test_text_sources.py`.
- **Impact:** Config changes round-trip through `.env` and survive restarts.
- **TTL / Review:** revisit when multi-user config or locking is needed.
- **Status:** active
- **Links:** goal admin-interface

### [2025-10-24] source-runner

- **Context:** Text sources were selectable but not consumed automatically.
- **Decision:** Instantiate sources via registry and stream their output to `orchestrated_pcm_stream` in a background task.
- **Alternatives:** Require manual piping for each request.
- **Trade-offs:** Introduces an additional long-lived asyncio task per active source.
- **Scope:** `Morpheus_Client/server.py`, `tests/test_text_sources.py`.
- **Impact:** WebSocket and CLI feeds drive synthesis without bespoke wiring.
- **TTL / Review:** review when multiple concurrent sources are supported.
- **Status:** active
- **Links:** goal pluggable-text-sources

### [2025-10-30] orchestrator-transcripts

- **Context:** Need to retain utterance text for replay and operator insight.
- **Decision:** Record `{timestamp,text}` per utterance, expose transcripts via `/stats`, and persist them to `SCENES/_artifacts/transcripts.json`.
- **Alternatives:** Depend solely on unstructured logs.
- **Trade-offs:** Transcript list grows unbounded; potential privacy concerns.
- **Scope:** `Morpheus_Client/orchestrator/core.py`, `Morpheus_Client/server.py`, `scenes/utils.py`, `tests/*`.
- **Impact:** Enables replayable transcript history alongside timeline events.
- **TTL / Review:** revisit when persistence or pruning is required.
- **Status:** active
- **Links:** goal transcript-history

### [2025-08-19] user-config-precedence

- **Context:** Configuration persisted only to repo-level `.env`, forcing manual merges across checkouts.
- **Decision:** Mirror saved config to `~/.morpheus/config` and load it before `.env` at startup.
- **Alternatives:** Rely solely on `.env` in the repository.
- **Trade-offs:** Two config files may drift without tooling.
- **Scope:** `Morpheus_Client/config.py`, `scripts/start.py`, `.env.example`.
- **Impact:** User-specific configuration persists outside the repository and overrides `.env` values.
- **TTL / Review:** revisit when multi-user setups or locking are required.
- **Status:** active
- **Links:** goal user-config-precedence

### [2025-08-19] admin-voices-runtime

- **Context:** Admin template embedded voice and language options via Jinja, preventing `/admin` from being served purely as static assets.
- **Decision:** Remove server-side templating and fetch voices and languages from `/v1/audio/voices` at runtime.
- **Alternatives:** Pre-render voices into HTML during build.
- **Trade-offs:** Adds client-side rendering dependency and requires API availability on initial load.
- **Scope:** `Morpheus_Client/admin/tts.html`, `Morpheus_Client/server.py`, `tests/test_admin_dynamic_voices.py`
- **Impact:** `/admin` assets are static and voice lists stay in sync with backend at runtime.
- **TTL / Review:** revisit if voices endpoint becomes unstable or large.
- **Status:** active
- **Links:** goal admin-voices-runtime

### [2025-10-30] tunable-inference-params

- **Context:** Operators need to tweak sampling settings without editing files or restarting.
- **Decision:** `/config` accepts `ORPHEUS_TEMPERATURE`, `ORPHEUS_TOP_P`, and `ORPHEUS_MAX_TOKENS`, validates them, persists to `.env`, and updates inference globals.
- **Alternatives:** Require manual `.env` edits followed by process restart.
- **Trade-offs:** Defaults remain in memory for modules that snapshot values at import.
- **Scope:** `Morpheus_Client/server.py`, `Morpheus_Client/tts_engine/inference.py`, `Morpheus_Client/admin/tts.html`, tests.
- **Impact:** Sampling behaviour can be tuned at runtime and survives restarts via persisted config.
- **TTL / Review:** revisit when more parameters or hot-reload of all modules is required.
- **Status:** active
- **Links:** goal tunable-inference-params

### [2025-08-24] setup-scripts-no-file-mods

- **Context:** Ensure deterministic editing of `requirements.txt` and `README.md` by avoiding concurrent modifications from setup scripts.
- **Decision:** Reviewed `scripts/install.py` and `scripts/one_click.py`; both only read `requirements.txt` and leave `README.md` untouched, so no automated edits occur.
- **Alternatives:** Run setup scripts before editing in case they mutate these files.
- **Trade-offs:** Future changes to setup scripts could introduce file mutations requiring re-evaluation.
- **Scope:** `scripts/install.py`, `scripts/one_click.py`.
- **Impact:** Manual edits to `requirements.txt` and `README.md` remain single-source of truth.
- **TTL / Review:** Revisit if setup scripts gain write steps.
- **Status:** active
- **Links:** goal centralized-docs

### [2025-08-24] default-audio-streaming

- **Context:** `README.md` documented text streaming while the service and client stream WAV audio.
- **Decision:** Use WAV audio streaming as the default and update documentation to match.
- **Alternatives:** Rework the codebase to stream UTF-8 text instead of audio.
- **Trade-offs:** Clients must handle binary data; switching to text would diverge from TTS functionality.
- **Scope:** `README.md`.
- **Impact:** Documentation reflects actual endpoints so integrators expect WAV output.
- **TTL / Review:** Revisit if text streaming becomes a requirement.
- **Status:** active
- **Links:** goal centralized-docs

### [2025-08-24] static-admin-ui

- **Context:** `README.md` implied the admin dashboard required a Node.js build.
- **Decision:** Document the dashboard as purely static HTML with no Node tooling.
- **Alternatives:** Introduce a `package.json` and build pipeline for the admin UI.
- **Trade-offs:** Forgoing tooling keeps the UI simple but limits future enhancements.
- **Scope:** `README.md`.
- **Impact:** Reduces setup steps and external dependencies.
- **TTL / Review:** Revisit if the dashboard gains dynamic features.
- **Status:** active
- **Links:** goal centralized-docs

### [2025-08-24] quick-start-docs

- **Context:** The README lacked guidance on creating a virtual environment and mentioned no one-command bootstrap option.
- **Decision:** Add a Quick Start section documenting virtual environment setup and reference the `scripts/one_click.py` bootstrap script.
- **Alternatives:** Leave installation instructions as-is without highlighting environment isolation.
- **Trade-offs:** Additional documentation requires upkeep as setup scripts evolve.
- **Scope:** `README.md`, `DECISIONS.log`.
- **Impact:** New contributors can isolate dependencies quickly and discover the one-click setup path.
- **TTL / Review:** Revisit if the bootstrap process changes or a `bootstrap.sh` replaces `one_click.py`.
- **Status:** active
- **Links:** goal centralized-docs

### [2025-08-24] fresh-readme-setup

- **Context:** The existing README was removed; users needed a concise guide to install dependencies and run the TTS service.
- **Decision:** Recreate the README with manual and one-click install paths, hardware-specific Torch guidance, and a CLI verification step.
- **Alternatives:** Incrementally patch the previous README.
- **Trade-offs:** A fresh document must be kept in sync with setup scripts.
- **Scope:** `README.md`, `CHANGES.md`, `DECISIONS.log`.
- **Impact:** Users can follow a single set of instructions to launch Morpheus and verify audio streaming.
- **TTL / Review:** Revisit when setup flows change or text streaming replaces audio.
- **Status:** active
- **Links:** goal centralized-docs
### [2025-08-24] start-path-prepend

- **Context:** Running `scripts/start.py` directly failed because the repository root wasn't on `sys.path`.
- **Decision:** Prepend the repository root to `sys.path` within `scripts/start.py`.
- **Alternatives:** Require launching via `python -m` or packaging the project.
- **Trade-offs:** Adds a small path tweak but avoids packaging overhead.
- **Scope:** `scripts/start.py`.
- **Impact:** The start script can import `Morpheus_Client` without installation.
- **TTL / Review:** Revisit if the project becomes an installable package.
- **Status:** active
- **Links:** n/a

### [2025-09-06] admin-input-field

- **Context:** The admin UI sent `{text,...}` to `/v1/audio/speech`, but the API expects an `input` field, leading to HTTP 400 responses.
- **Decision:** Send `{input,...}` in the request body and rename the textarea `id`/`name` to `input` to mirror the API.
- **Alternatives:** Adjust the API to accept `text` or handle both fields.
- **Trade-offs:** Updating the UI avoids expanding server input validation while touching only client code.
- **Scope:** `Morpheus_Client/admin/index.html`.
- **Impact:** Admin submissions now conform to the API and generate audio instead of 400 errors.
- **TTL / Review:** Revisit if the speech endpoint schema changes.
- **Status:** active
- **Links:** n/a

### [2025-09-20] one-click-gpu-detection

- **Context:** GPU-equipped systems required manual selection of Torch and `llama-cpp-python` builds, complicating setup.
- **Decision:** Extend `scripts/one_click.py` to detect CUDA or ROCm and install matching Torch, `llama-cpp-python`, `bitsandbytes`, and `flash-attn` wheels.
- **Alternatives:** Leave hardware-specific commands in documentation for manual execution.
- **Trade-offs:** Script embeds URLs that may change upstream and adds more installation logic.
- **Scope:** `scripts/one_click.py`, `requirements.txt`.
- **Impact:** Users with NVIDIA or AMD GPUs get optimized dependencies automatically; CPU-only flows remain unchanged.
- **TTL / Review:** Revisit when PyTorch or `llama-cpp-python` release new wheel indexes.
- **Status:** active
- **Links:** goal gpu-aware-one-click
