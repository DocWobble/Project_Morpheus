# DECISIONS.log

> ADR-style, but ruthless. One entry per consequential choice.  
> Append-only; if superseded, add `Superseded-By:` and status `REPLACED`.

## Entry Template

### [YYYY-MM-DD] <short handle>

- **Context:** <why a choice was necessary; constraints at play>
- **Decision:** <the chosen path in one or two sentences>
- **Alternatives:** <bulleted, only those genuinely considered>
- **Trade-offs:** <what we accept to get the outcome>
- **Scope:** <surfaces or modules affected>
- **Impact:** <capabilities enabled/disabled; risks introduced>
- **TTL / Review:** <when to re-evaluate, if applicable>
- **Status:** ACTIVE | REPLACED | REJECTED | BLOCKED
- **Links:** <PRs, scenes, interface entries, goal names>

_(New entries go on top. Keep each under ~20 lines.)_
### [2025-09-01] single-service-architecture

- **Context:** Prior repos split FastAPI, orchestrator, and admin surfaces; deployment required coordinating multiple services.
- **Decision:** Consolidate into one FastAPI service (`Orpheus-FastAPI`) exposing `/stats`, `/config`, and `/admin` with `.env`-based configuration.
- **Alternatives:** Maintain separate processes for TTS generation, control plane, and UI; shell scripts per component.
- **Trade-offs:** Sacrifices modular scaling but simplifies local runs and scene coverage.
- **Scope:** `Orpheus-FastAPI/app.py`, runtime config paths, admin endpoints.
- **Impact:** Enables standalone orchestrator, admin interface, and direct inference integration.
- **TTL / Review:** Revisit when horizontal scaling or process isolation is required.
- **Status:** ACTIVE
- **Links:** goals standalone-orchestrator, admin-interface, direct-inference-integration; interfaces /stats, /config, /admin
### [2025-08-18] decisions-log-canonical

- **Context:** Repository contained `DECISIONS.md` while documentation referenced `DECISIONS.log`, causing inconsistency.
- **Decision:** Rename the decision log to `DECISIONS.log` and update references for a single canonical filename.
- **Alternatives:** Keep `DECISIONS.md` and adjust all docs.
- **Trade-offs:** `.log` extension receives less automatic Markdown tooling.
- **Scope:** repository metadata files.
- **Impact:** Eliminates confusion about where to record decisions.
- **TTL / Review:** Revisit if extension hampers collaboration.
- **Status:** ACTIVE
- **Links:** this PR

### [2025-08-30] cli-exitcode-refactor

- **Context:** Subcommands invoked std::process::exit directly, complicating error handling and testing.
- **Decision:** Return ExitCode from `cli_main` and exit once in `main`.
- **Alternatives:** Keep multiple exit points within subcommands.
- **Trade-offs:** Requires threading exit codes through call sites.
- **Scope:** `codex-rs/cli`, `codex-rs/arg0`.
- **Impact:** Centralizes process termination and enables integration tests to assert exact exit codes.
- **TTL / Review:** Revisit if CLI architecture changes.
- **Status:** ACTIVE
- **Links:** goal cli-exit-code-centralization


### [2025-08-29] cli-path-dedup

- **Context:** Repeated CLI launches added duplicate directories to `PATH` causing unbounded growth.
- **Decision:** Skip directories already present in `PATH` when computing the updated value.
- **Alternatives:** Keep existing behavior and allow duplicates.
- **Trade-offs:** Slight increase in startup logic complexity.
- **Scope:** `codex-cli/bin/codex.js`.
- **Impact:** CLI startup is idempotent with respect to environment `PATH`.
- **TTL / Review:** Revisit if environment handling changes.
- **Status:** ACTIVE
- **Links:** goal cli-path-deduplication; `codex-cli/test/path.test.js`

### [2025-08-17] missing-sandbox-error

- **Context:** `codex-cli` panicked when the `codex-linux-sandbox` binary was missing.
- **Decision:** Return a descriptive error instead of panicking so users understand the failure.
- **Alternatives:** Keep using `.expect` and crash.
- **Trade-offs:** Slightly more code; reliance on error handling.
- **Scope:** `codex-rs/cli` sandbox command path.
- **Impact:** CLI fails gracefully when Landlock sandbox is requested without the binary.
- **TTL / Review:** Revisit if sandbox architecture changes.
- **Status:** ACTIVE
- **Links:** See PR for missing sandbox executable handling.

### [2025-08-19] login-result-handling

- **Context:** Login helpers exited the process directly, making reuse and testing difficult.
- **Decision:** Return `Result`/status enums from login helpers and manage exits in `main.rs`.
- **Alternatives:** Keep process termination inside helper functions.
- **Trade-offs:** More boilerplate in the caller; functions now expose additional types.
- **Scope:** `codex-rs/cli` login module and main entrypoint.
- **Impact:** Enables programmatic control over login flows and clearer testing.
- **TTL / Review:** Revisit when authentication flow changes.
- **Status:** ACTIVE
- **Links:** goal result-based-login
### [2025-09-02] central-config-module

- **Context:** configuration helpers were duplicated across `main.py` and `Orpheus-FastAPI/app.py`.
- **Decision:** centralize env file utilities and config API routes in `Morpheus_Client.config`.
- **Alternatives:** keep separate implementations in each module.
- **Trade-offs:** introduces a new package; minor import overhead.
- **Scope:** `Morpheus_Client/config.py`, `main.py`, `Orpheus-FastAPI/app.py`.
- **Impact:** shared configuration logic and API surface; easier future reuse.
- **TTL / Review:** revisit when configuration loading changes.
- **Status:** active
- **Links:** n/a
### [2025-08-18] morpheus-client-endpoints
- **Context:** Morpheus Client lacked introspection APIs for voices and adapters.
- **Decision:** Add `/v1/audio/voices` and `/adapters` endpoints reusing Orpheus-FastAPI logic.
- **Alternatives:** Rely solely on Orpheus-FastAPI for capability discovery.
- **Trade-offs:** Duplicates minimal logic; adds another API surface to maintain.
- **Scope:** `Morpheus_Client/api/server.py`, `INTERFACES.md`.
- **Impact:** Clients can query available voices and adapter capabilities directly.
- **TTL / Review:** revisit when services consolidate.
- **Status:** active
- **Links:** goal morpheus-client-introspection
### [2025-09-02] admin-static-mount

- **Context:** The admin TTS UI lived only in Orpheus-FastAPI and wasn't available through the consolidated client.
- **Decision:** Copy the template and favicon into `Morpheus_Client/admin` and serve them via `/admin`.
- **Alternatives:** Continue relying on Orpheus-FastAPI for admin access.
- **Trade-offs:** Duplicates assets and requires future sync.
- **Scope:** `Morpheus_Client/admin`, `Morpheus_Client/api/server.py`, `Morpheus_Client/config.py`.
- **Impact:** Admin interface assets are accessible from the client service.
- **TTL / Review:** revisit when UI unification completes.
- **Status:** active
- **Links:** goal admin-interface
### [2025-09-02] admin-favicon-svg

- **Context:** Binary favicon blocked pull request generation.
- **Decision:** Replace `.ico` with a text-based `favicon.svg` and update the admin template.
- **Alternatives:** Keep binary icon and accept PR tooling limitation.
- **Trade-offs:** Simplified icon; avoids binary files in repository.
- **Scope:** `Morpheus_Client/admin/tts.html`, `Morpheus_Client/admin/static/favicon.svg`.
- **Impact:** Admin interface assets remain mergeable while providing a visual icon.
- **TTL / Review:** revisit when branding assets stabilize.
- **Status:** active
- **Links:** goal admin-interface
